
<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="utf-8">
  
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="CNPaaS">

  <!-- Always force latest IE rendering engine or request Chrome Frame -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">

  <link rel="shortcut icon" href="/images/favicon/favicon.ico" type="image/ico" />
<link sizes="16x16 32x32 64x64" href="/images/favicon/favicon.ico" rel="icon" type="image/ico" />
<link sizes="196x196" href="/images/favicon/favicon-196.png" rel="icon" type="image/png" />
<link sizes="160x160" href="/images/favicon/favicon-160.png" rel="icon" type="image/png" />
<link sizes="96x96" href="/images/favicon/favicon-96.png" rel="icon" type="image/png" />
<link sizes="64x64" href="/images/favicon/favicon-64.png" rel="icon" type="image/png" />
<link sizes="32x32" href="/images/favicon/favicon-32.png" rel="icon" type="image/png" />
<link sizes="16x16" href="/images/favicon/favicon-16.png" rel="icon" type="image/png" />
<link sizes="152x152" rel="apple-touch-icon" href="/images/favicon/favicon-152.png" type="image/png" />
<link sizes="144x144" rel="apple-touch-icon" href="/images/favicon/favicon-144.png" type="image/png" />
<link sizes="120x120" rel="apple-touch-icon" href="/images/favicon/favicon-120.png" type="image/png" />
<link sizes="114x114" rel="apple-touch-icon" href="/images/favicon/favicon-114.png" type="image/png" />
<link sizes="76x76" rel="apple-touch-icon" href="/images/favicon/favicon-76.png" type="image/png" />
<link sizes="72x72" rel="apple-touch-icon" href="/images/favicon/favicon-72.png" type="image/png" />
<link rel="apple-touch-icon" href="/images/favicon/favicon-57.png" type="image/png" />
<meta content="#FFFFFF" name="msapplication-TileColor" />
<meta content="/images/favicon/favicon-144.png" name="msapplication-TileImage" />
<meta content="/images/favicon/browserconfig.xml" name="msapplication-config" />


  <title>Fig 及 Tutum 学习小结 - CNPaaS 博客</title>

  
  
  <link href="/stylesheets/default.css" media="screen, projection" rel="stylesheet" type="text/css">
  <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js" type="text/javascript"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js" type="text/javascript"></script>
  <![endif]-->

  
  <link rel="canonical" href="http://blog.cnpaas.io/blog/fig-tutum-study-note">
  
  <link href="/atom.xml" rel="alternate" title="CNPaaS 博客" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//libs.useso.com/js/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-34822035-10']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <div id="cnpaas" class="hidden" data-env="production"></div>
  <!-- NAVBAR -->
<div class="navbar navbar-inverse navbar-fixed-top navbar-cnpaas" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="sr-only">切换导览</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="/" class="navbar-brand">
        CNPaaS 博客
      </a>
    </div>
    <div class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right user-login">
        <li><a href="http://www.cnpaas.io/#features">重点功能</a></li>
        <li><a href="http://www.cnpaas.io/pricing">价格</a></li>
        <li><a href="http://doc.cnpaas.io">文档</a></li>
        <li class="dropdown active">
          <a href="#" data-toggle="dropdown">
            <span>关于我们</span>
            <span class="caret"></span>
          </a>
          <ul class="dropdown-menu dropdown-menu-right" data-role="menu" aria-labelledBy="dLabel">
            <li><a href="http://www.cnpaas.io/vision">公司愿景</a></li>
            <li><a href="http://www.cnpaas.io/team">团队介绍</a></li>
            <li class="active"><a href="/">团队博客</a></li>
            <li><a href="http://www.cnpaas.io/contact-us">联系我們</a></li>
          </ul>
        </li>

        <li class="user-login-loading-controls"><p class="navbar-text"><span class="glyphicon glyphicon-refresh glyphicon-spin"/></p></li>
        <li class="user-login-false-controls"><a href="http://dashboard.cnpaas.io/accounts/sign_in">登入</a></li>
        <li class="user-login-false-controls">
          <div><a href="http://dashboard.cnpaas.io/accounts/sign_up" class="btn btn-info navbar-btn margin-left">注册</a></div>
        </li>

        <li class="dropdown user-login-true-controls">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">
            <span class="user-login-user_slug"> username</span>
            <span class="caret"></span>
          </a>
          <ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledBy="dLabel">
            <li><a href="http://dashboard.cnpaas.io/a">应用总滙</a></li>
            <li><a href="http://dashboard.cnpaas.io/accounts/edit">帐号设置</a></li>
            <li class="divider"></li>
            <li><a href="http://dashboard.cnpaas.io/accounts/sign_out" data-method="delete">用户登出</a></li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
</div>

  <div class="container content">
  <div class="row">
    <div class="col-md-9">
      

      <article class="hentry" role="article">
        
  <header>
    
      <h1 class="entry-title">Fig 及 Tutum 学习小结</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-09-29T16:59:17+08:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>29</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>4:59 pm</span></time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="http://blog.cnpaas.io">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><h2>Fig － Docker 多容器协调工具</h2>

<p><img class="center" src="http://www.fig.sh/img/logo.png" width="180" title="Fig - Docker 多容器协调工具" ></p>

<p>我最近和同事共同研究 Docker 的开发生态系统。今天开始去尝试用 <a href="http://www.fig.sh/">Fig</a>. Fig 团队甚至乎被 <a href="http://www.docker.com">Docker</a> <a href="http://blog.docker.com/2014/07/welcoming-the-orchard-and-fig-team/">原团队收购去</a>了。</p>

<p>如果你在开发 RoR 应用时用过 Foreman 布署应用。就不难理解 Fig。现在网络应用趋向分成不同的服务, 以服务为单元来运行。这样一个应用跑起来底下其实就有好几个服务的互相协调运作。一个 RoR 应用可以有 Rails 的服务，数据库服务，及 后台 workers 的服务。而 Foreman 就是那工具可轻松的把这三个服务一并跑起来并互相连接，使那个应用能完整的运作。</p>

<p>那现在当你把 Docker 整合到你的开发流程里面，有多个服务，你就要把每个服务设到一个 Docker 容器内跑，并把各容器连起来让他们能沟通起来。但其实要把一个应用容器化其实是有挺多东西要设置的。我们团队也手动设置过一个组件放在 Docker 容器跑，这可能就花上 三天时间吧。而现在是多个应用，并最后把它连起来。Fig 就是用来解决这个问题。</p>

<p>在一个 fig.yml (可理解为 Foreman 里的 Procfile 般) 里，你就设定此应用的不同组件，及他们如何连结，挺方便。以下是一个跑 Rails 应用的 设置。</p>

<figure class='code'><figcaption><span>一个 fig.yml 的范例</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">db</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">image</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">postgres:latest</span>
</span><span class='line'>  <span class="l-Scalar-Plain">ports</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="p-Indicator">-</span> <span class="s">&quot;5432&quot;</span>
</span><span class='line'><span class="l-Scalar-Plain">web</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">build</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">.</span>
</span><span class='line'>  <span class="l-Scalar-Plain">command</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">bundle exec rackup -p 3000</span>
</span><span class='line'>  <span class="l-Scalar-Plain">volumes</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">.:/myapp</span>
</span><span class='line'>  <span class="l-Scalar-Plain">ports</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="p-Indicator">-</span> <span class="s">&quot;3000:3000&quot;</span>
</span><span class='line'>  <span class="l-Scalar-Plain">links</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">db</span>
</span></code></pre></td></tr></table></div></figure>


<p>这里说明了有一个 <code>db</code> 及 <code>web</code> 的服务。<code>db</code> 的服务来自 Docker 官方镜像 <code>postgres:latest</code>, 听着 <code>5432</code> 端口。而 <code>web</code> 那边，则会从本目录的 Dockerfile 来 建立起来。最后走的指令是 <code>bundle exec rackup -p 3000</code>. 本目录 也分享到容器内的 <code>myapp</code> 目录内。最后就是把他与 <code>db</code> 容器连起来。</p>

<h4>Fig 的另一利害之处</h4>

<p>我认为 Fig 另一个利害的地方是他有一个 <a href="http://www.fig.sh/cli.html">scale 的指令</a>，如下：</p>

<pre><code>fig scale web=2 worker=3
</code></pre>

<p>然后就可很容易的把应用扩展为多个单元 跑在不同的容器内。当然，如果真在生产环境跑一个应用，我们还要在前面设负载均衡器，及如何可把容器放在不同的物理服务器内。这些文档也没有详细说明。</p>

<p>留待下一步试验吧。</p>

<h2>Tutum － Docker 容器的云托管服务</h2>

<p><img class="center" src="/images/posts/tutum.png" width="180px" title="Tutum － Docker 容器的云托管服务"></img></p>

<p>Docker 生态已足够巨大到甚至乎有初创企业搞了个 Docker 容器的云托管服务。<a href="www.tutum.co">Tutum</a> 就是赌在会越来越多人在 Docker 上作开发，以致到以 Docker 为单元的去部署生产应用。这样的话，一台虚拟机也嫌多，你需要的只是一个地方可跑你多个 Docker 容器。</p>

<p>而且他也有一些模版，可试范怎样跑起一个 MySQL 服务来，甚至怎样跑起一个 WordPress 来 (就是如何把一个 php 服务和 数据库服务跑并连起来)。</p>

<p>到底以 Docker 为单位的部署到生产环境上这概念，会被接受到那从程度，在国内的接受度又会怎样？这些都拭目以待。</p>
</div>


        <footer>
          <p class="meta">
            
  

<span class="byline author vcard">Posted by <span class="fn">Jimmy Chu</span></span>

            




<time class='entry-date' datetime='2014-09-29T16:59:17+08:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>29</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>4:59 pm</span></time>
            

<span class="categories">
  
    <a class='category' href='/blog/categories/docker/'>docker</a>, <a class='category' href='/blog/categories/fig/'>fig</a>, <a class='category' href='/blog/categories/paas/'>paas</a>, <a class='category' href='/blog/categories/tutum/'>tutum</a>
  
</span>


          </p>
          
            <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://blog.cnpaas.io/blog/fig-tutum-study-note/" data-via="" data-counturl="http://blog.cnpaas.io/blog/fig-tutum-study-note/" >Tweet</a>
  
  
  
</div>

          
          <p class="meta margin-top clearfix">
            
              <a class="basic-alignment pull-left" href="/blog/first-docker-meetup-in-hong-kong/" title="Previous Post: First Docker Meetup in Hong Kong">&laquo; First Docker Meetup in Hong Kong</a>
            
            
              <a class="basic-alignment pull-right" href="/blog/2015-mar-update/" title="Next Post: CNPaaS 3月快讯">CNPaaS 3月快讯 &raquo;</a>
            
          </p>
        </footer>
      </article>
      
        <section>
          <h1>Comments</h1>
          <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
        </section>
      
    </div>

    
    <div class="col-md-3">
      <aside class="sidebar">
        
          <section>
  <h2>Recent Posts</h2>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015-oct-update/">CNPaaS 10月 与用户书</a>
      </li>
    
      <li class="post">
        <a href="/blog/company-vision/">公司愿景</a>
      </li>
    
      <li class="post">
        <a href="/blog/climbing-over-the-gfw/">Climbing Over the GFW</a>
      </li>
    
      <li class="post">
        <a href="/blog/nei-di-fan-qiang-xin-de/">内地翻墙心得</a>
      </li>
    
      <li class="post">
        <a href="/blog/event-01-result/">中、大容器有奖活动结果公布</a>
      </li>
    
  </ul>
</section>

        
      </aside>
    </div>
    

  </div>
</div>

  

  
    <script type="text/javascript">
      var disqus_shortname = 'cloudhackinggrouphksoutherncn';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://blog.cnpaas.io/blog/fig-tutum-study-note/';
        var disqus_url = 'http://blog.cnpaas.io/blog/fig-tutum-study-note/';
        var disqus_script = 'embed.js';
      
      (function () {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }());
    </script>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


<script src="/javascripts/modernizr-2.0.js"></script>
<script src="/javascripts/libs/jquery-2.1.1.min.js"></script>
<script src="/javascripts/libs/bootstrap.min.js"></script>
<script src="/javascripts/libs/baidu_tongji.js"></script>
<script src="/javascripts/octopress.js" type="text/javascript"></script>
<script src="/javascripts/user-login.js" type="text/javascript"></script>
<script src="/javascripts/navbar-collapse-fix.js" type="text/javascript"></script>
<script src="/javascripts/data-method.js" type="text/javascript"></script>


</body>
</html>
